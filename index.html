<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高中段考題庫中心</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .katex { font-size: 1.1em; }
        .explanation-box { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- 1. Data Store ---

        // ★★★ 設定 PDF 連結的位置 (已更新為您的雲端連結) ★★★
        const DRIVE_LINK = "https://drive.google.com/drive/u/0/folders/1H0IIHGhbdAJZkaBHJIbexbC5CbK7kh0M";
        
        const PDF_LINKS = {
            "1_2_chem": DRIVE_LINK,
            "1_2_geo": DRIVE_LINK,
            "1_2_earth": DRIVE_LINK,
            "1_2_bio": DRIVE_LINK,
            "1_2_phy": DRIVE_LINK,
            "1_2_math": DRIVE_LINK
        };

        const QUESTION_DATABASE = {
            // --- 化學 (Chemistry) - 25 題 ---
            "1_2_chem": [
                {
                    id: "chem_01", number: 1, type: "單選",
                    question: "取 3.2 克的 $TiO_2$ 於氫氣中受熱，失去部分的氧，質量減少 0.32 克，形成另一種氧化物，則此氧化物之化學式為何？",
                    options: [ { label: "A", text: "TiO" }, { label: "B", text: "Ti₂O" }, { label: "C", text: "Ti₂O₃" }, { label: "D", text: "TiO₃" } ],
                    answer: "C",
                    explanation: "1. $TiO_2$ 式量=80，Ti 莫耳數=0.04 mol。\n2. 原氧重 1.28g，剩氧重 0.96g (0.06 mol)。\n3. Ti:O = 0.04:0.06 = 2:3。"
                },
                { id: "chem_02", number: 2, type: "單選", question: "僅含有 C、H、O 之某二物實驗結果其元素的重量百分組成相同，同狀況下的蒸氣密度亦相同，但熔點、沸點有顯著差異，則可判斷此二物何者不同？", options: [{label:"B", text:"結構式"}], answer: "B", explanation: "同分異構物：分子式相同但結構式不同。" },
                { id: "chem_03", number: 3, type: "單選", question: "試問完全電解 90 公斤的水，可產生氫氣多少公斤？", options: [{label:"B", text:"10"}], answer: "B (或D 10kg)", explanation: "水 5000 mol -> 氫氣 5000 mol = 10 kg。" },
                { id: "chem_04", number: 4, type: "單選", question: "反應 aA + bB → cC + dD，分子量 A=30, B=60, C=90。欲生成 100 克 D，至少需要 A 若干克？", options: [{label:"A", text:"100a/(a+2b-3c)"}], answer: "A", explanation: "利用質量守恆推導。" },
                { id: "chem_05", number: 5, type: "單選", question: "根據氣體 X、Y、Z 的初始與平衡條件，求反應式。", options: [{label:"B", text:"3X+Y->2Z (數據反推)"}], answer: "B", explanation: "變化量比 1:3:2，應為 X+3Y->2Z，選項B最接近。" },
                { id: "chem_06", number: 6, type: "單選", question: "乙烷和丙烷混合燃燒，求莫耳數比。", options: [{label:"D", text:"3:2"}], answer: "D", explanation: "列聯立方程式求解。" },
                { id: "chem_07", number: 7, type: "單選", question: "關於氫氣燃燒與過氧化氫分解，何者錯誤？", options: [{label:"C", text:"2莫耳氫氣燃燒放出285.8kJ"}], answer: "C", explanation: "1莫耳放出285.8kJ，2莫耳應為兩倍。" },
                { id: "chem_08", number: 8, type: "單選", question: "鹽酸與漂白水混合，求氯氣 ppm。", options: [{label:"A", text:"7.1x10^-4"}], answer: "A", explanation: "計算生成氯氣質量除以總水重。" },
                { id: "chem_09", number: 9, type: "單選", question: "2ppm 臭氧稀釋至原體積 2 倍，求體積莫耳濃度。", options: [{label:"D", text:"2.08x10^-5"}], answer: "D", explanation: "稀釋後 1ppm，換算為 M。" },
                { id: "chem_10", number: 10, type: "單選", question: "嗎啡燃燒係數平衡，求係數和。", options: [{label:"B", text:"195"}], answer: "B", explanation: "平衡後係數和為 195。" },
                { id: "chem_11", number: 11, type: "單選", question: "承上題，求嗎啡純度。", options: [{label:"D", text:"67.1%"}], answer: "D", explanation: "由 CO2 反推嗎啡重。" },
                { id: "chem_12", number: 12, type: "單選", question: "NaOH 與 HCl 反應，加入 15g NaOH 時溶液成分？", options: [{label:"A", text:"NaCl, H2O, HCl"}], answer: "A", explanation: "NaOH 不足，HCl 過量。" },
                { id: "chem_13", number: 13, type: "單選", question: "加入 10g NaOH 時，溫度約為？", options: [{label:"B", text:"26度"}], answer: "B", explanation: "量減半，溫升減半。" },
                { id: "chem_14", number: 14, type: "單選", question: "1 分子蔗糖可得幾分子酒精？", options: [{label:"D", text:"4"}], answer: "D", explanation: "1蔗糖->2葡萄糖->4酒精。" },
                { id: "chem_15", number: 15, type: "單選", question: "1 分子酒精燃燒消耗多少分子氧？", options: [{label:"C", text:"3"}], answer: "C", explanation: "係數比 1:3。" },
                { id: "chem_16", number: 16, type: "多選", question: "有機物含氧 16.05%，含硫 8.00%，分子量可能為？", options: [{label:"DE", text:"400, 800"}], answer: "DE", explanation: "最簡分子量 400。" },
                { id: "chem_17", number: 17, type: "多選", question: "丙烷燃燒體積變化。", options: [{label:"AD", text:"分子數減少, 水氣氧氣分子數同"}], answer: "AD", explanation: "體積計算。" },
                { id: "chem_18", number: 18, type: "多選", question: "CnH2n+2O 燃燒生成 4CO2 與 5H2O。", options: [{label:"CDE", text:"分子量74..."}], answer: "CDE", explanation: "推導為 C4H10O。" },
                { id: "chem_19", number: 19, type: "多選", question: "太空梭燃料反應。", options: [{label:"ABC", text:"..."}], answer: "ABC", explanation: "化學計量。" },
                { id: "chem_20", number: 20, type: "多選", question: "光合作用與呼吸作用能量。", options: [{label:"ABD", text:"光合吸熱, 呼吸放熱..."}], answer: "ABD", explanation: "能量轉換觀念。" },
                { id: "chem_21", number: 21, type: "多選", question: "氫氣燃燒能量圖。", options: [{label:"BCE", text:"..."}], answer: "BCE", explanation: "熱化學方程式判讀。" },
                { id: "chem_22", number: 22, type: "多選", question: "物質三態與冷熱敷包。", options: [{label:"ABE", text:"..."}], answer: "ABE", explanation: "相變能量。" },
                { id: "chem_23", number: 23, type: "多選", question: "放熱反應能量圖。", options: [{label:"CD", text:"..."}], answer: "CD", explanation: "反應物能量高於生成物。" },
                { id: "chem_24", number: 24, type: "多選", question: "吸熱與放熱比較。", options: [{label:"ADE", text:"..."}], answer: "ADE", explanation: "生活實例判斷。" },
                { id: "chem_25", number: 25, type: "多選", question: "膠體溶液性質。", options: [{label:"BDE", text:"..."}], answer: "BDE", explanation: "膠體特性。" }
            ],

            // --- 地科 (Earth Science) ---
            "1_2_earth": [
                {
                    id: "earth_01", number: 1, type: "單選",
                    question: "[需參考圖表] 甲、乙、丙、丁四人在不同緯度觀察的星空軌跡如下圖所示，依緯度由北至南的順序何者正確？",
                    options: [ { label: "E", text: "依手寫註記 (通常越接近同心圓緯度越高)" } ], 
                    answer: "E",
                    explanation: "**解析：** 越靠近北極，北極星仰角越高，恆星軌跡越接近水平圓圈。"
                },
                {
                    id: "earth_02", number: 2, type: "單選",
                    question: "試問到隔日 12 時太陽過中天的期間，地球自轉的角度約多少度？經過時間多久？",
                    options: [ { label: "B", text: "約 361 度, 24 小時" } ],
                    answer: "B",
                    explanation: "**解析：** 太陽日(24小時)內，地球除自轉360度外，因公轉約1度，需多轉1度太陽才對準中天，故約361度。"
                },
                {
                    id: "earth_03", number: 3, type: "單選",
                    question: "下列哪一項證據，使板塊構造學說得以證實動力來源？",
                    options: [ { label: "C", text: "地震學資訊發現低速帶之軟流圈存在" } ],
                    answer: "C",
                    explanation: "**解析：** 軟流圈物質的熱對流被認為是驅動板塊運動的主要動力。"
                },
                {
                    id: "earth_04", number: 4, type: "單選",
                    question: "小王到倫敦(緯度51.5度)留學，星星運動旋轉的中心(天球北極)位於何處？",
                    options: [ { label: "A", text: "北方天空仰角 51.5 度" } ],
                    answer: "A",
                    explanation: "**解析：** 北半球天球北極仰角 = 當地緯度。"
                },
                {
                    id: "earth_05", number: 5, type: "單選",
                    question: "若地球自轉方向改為順時針(與公轉相反)，太陽日與恆星日長度比較？",
                    options: [ { label: "A", text: "太陽日較恆星日短約 4 分鐘" } ],
                    answer: "A",
                    explanation: "**解析：** 反向旋轉導致太陽日角度小於360度。"
                },
                {
                    id: "earth_06", number: 6, type: "單選",
                    question: "地震波沿途快速順序？",
                    options: [ { label: "C", text: "P 波 > S 波 > 表面波" } ],
                    answer: "C",
                    explanation: "**解析：** 速度：縱波(P) > 橫波(S) > 表面波(L/R)。"
                },
                {
                    id: "earth_07", number: 7, type: "單選",
                    question: "地球上產生四季變化的主要原因？",
                    options: [ { label: "B", text: "赤道面與黃道面有交角" } ],
                    answer: "B",
                    explanation: "**解析：** 地軸傾斜導致直射點移動。"
                },
                {
                    id: "earth_08", number: 8, type: "單選",
                    question: "為何臭氧濃度最高的區域氣溫並非最高？",
                    options: [ { label: "B", text: "平流層頂紫外線較強，吸收較多能量" } ],
                    answer: "B",
                    explanation: "**解析：** 上層臭氧先吸收高能紫外線而增溫。"
                },
                {
                    id: "earth_09", number: 9, type: "單選",
                    question: "有關台灣板塊構造及地質特徵，何者正確？",
                    options: [ { label: "D", text: "丙丁地區的火山島為島弧的一部分" } ],
                    answer: "D",
                    explanation: "**解析：** 呂宋島弧。"
                },
                {
                    id: "earth_10", number: 10, type: "單選",
                    question: "台灣板塊構造證據不包括？",
                    options: [ { label: "D", text: "由地質鑽探可觀測到上部板塊邊界" } ],
                    answer: "D",
                    explanation: "**解析：** 板塊邊界過深，無法直接鑽探觀測。"
                },
                {
                    id: "earth_11", number: 11, type: "單選",
                    question: "夏至正午影長最短，緯度可能為？",
                    options: [ { label: "D", text: "22.5 S (依試卷)" } ],
                    answer: "D",
                    explanation: "**解析：** 依試卷手寫答案。"
                },
                {
                    id: "earth_12", number: 12, type: "單選",
                    question: "秋分於南緯22.5度觀測，正午塔影尖端落在何處？",
                    options: [ { label: "B", text: "南方" } ],
                    answer: "B",
                    explanation: "**解析：** 太陽在北方，影在南方。"
                },
                {
                    id: "earth_13", number: 13, type: "單選",
                    question: "太陽全年軌跡皆在南方，最高仰角低，緯度為何？",
                    options: [ { label: "E", text: "南緯 65 度" } ],
                    answer: "E",
                    explanation: "**解析：** 南半球高緯度特徵。"
                },
                {
                    id: "earth_14", number: 14, type: "單選",
                    question: "南半球面向東方觀測天體運行軌跡？",
                    options: [ { label: "E", text: "左下傾斜升起" } ],
                    answer: "E",
                    explanation: "**解析：** 南半球天體向北傾斜運行。"
                },
                {
                    id: "earth_15", number: 15, type: "單選",
                    question: "圖中 A 波在外核消失，A 波是？",
                    options: [ { label: "B", text: "S 波" } ],
                    answer: "B",
                    explanation: "**解析：** S波無法通過液態外核。"
                },
                {
                    id: "earth_16", number: 16, type: "單選",
                    question: "古氏不連續面位於何處？",
                    options: [ { label: "C", text: "丙 (2900km處)" } ],
                    answer: "C",
                    explanation: "**解析：** 地函與地核交界。"
                },
                {
                    id: "earth_17", number: 17, type: "單選",
                    question: "軟流圈位置可能為？",
                    options: [ { label: "B", text: "乙" } ],
                    answer: "B",
                    explanation: "**解析：** 上部地函。"
                },
                {
                    id: "earth_18", number: 18, type: "單選",
                    question: "地球內外核比較何者錯誤？",
                    options: [ { label: "D", text: "外核是地球有磁場的原因(依試卷)" } ],
                    answer: "D",
                    explanation: "**解析：** 依試卷判斷。"
                },
                {
                    id: "earth_19", number: 19, type: "單選",
                    question: "5月21日子夜24時，仰角最高的星座？",
                    options: [ { label: "A", text: "天蠍座" } ],
                    answer: "A",
                    explanation: "**解析：** 與太陽位置(金牛)相對。"
                },
                {
                    id: "earth_20", number: 20, type: "單選",
                    question: "5/21 白天12時東方升起星座？",
                    options: [ { label: "A", text: "寶瓶座" } ],
                    answer: "A",
                    explanation: "**解析：** 太陽以東90度。"
                },
                {
                    id: "earth_21", number: 21, type: "單選",
                    question: "5/21 凌晨4點西方落下星座？",
                    options: [ { label: "C", text: "天秤座" } ],
                    answer: "C",
                    explanation: "**解析：** 計算時角差。"
                },
                {
                    id: "earth_24", number: 24, type: "單選",
                    question: "向北觀測星星中心與方向？",
                    options: [ { label: "D", text: "天球北極；逆時針" } ],
                    answer: "D",
                    explanation: "**解析：** 北半球特性。"
                },
                {
                    id: "earth_25", number: 25, type: "單選",
                    question: "當日幾時看到某星在乙位置？",
                    options: [ { label: "C", text: "22時" } ],
                    answer: "C",
                    explanation: "**解析：** 角度差對應時間。"
                },
                {
                    id: "earth_26", number: 26, type: "單選",
                    question: "若要看到某星在同一時間出現在乙位置，可能為何時？",
                    options: [ { label: "A", text: "7月底" } ],
                    answer: "A",
                    explanation: "**解析：** 恆星日每天提早4分，累積效應。"
                },
                {
                    id: "earth_27", number: 27, type: "單選",
                    question: "乾濕球溫度差異原因？",
                    options: [ { label: "D", text: "水分蒸發吸收熱量" } ],
                    answer: "D",
                    explanation: "**解析：** 蒸發冷卻。"
                },
                {
                    id: "earth_28", number: 28, type: "單選",
                    question: "四個城市中飽和水氣壓最低的城市？",
                    options: [ { label: "C", text: "丙 (3°C)" } ],
                    answer: "C",
                    explanation: "**解析：** 氣溫最低者飽和水氣壓最低。"
                },
                {
                    id: "earth_29", number: 29, type: "單選",
                    question: "四個城市中何者空氣中水氣含量最高？",
                    options: [ { label: "D", text: "丁 (露點26°C)" } ],
                    answer: "D",
                    explanation: "**解析：** 露點最高者水氣含量最高。"
                },
                {
                    id: "earth_30", number: 30, type: "單選",
                    question: "四個城市中相對濕度最低的城市？",
                    options: [ { label: "C", text: "43%" } ],
                    answer: "C",
                    explanation: "**解析：** 依試卷判讀。"
                },
                {
                    id: "earth_32", number: 32, type: "單選",
                    question: "東太平洋洋脊板塊運動方向？",
                    options: [ { label: "D", text: "箭頭相背 (張裂)" } ],
                    answer: "D",
                    explanation: "**解析：** 洋脊為張裂帶。"
                },
                {
                    id: "earth_33", number: 33, type: "單選",
                    question: "有關地磁紀錄敘述何者正確？",
                    options: [ { label: "B", text: "地核內電流方向..." } ],
                    answer: "B",
                    explanation: "**解析：** 依試卷手寫答案。"
                },
                {
                    id: "earth_34", number: 34, type: "多選",
                    question: "[題組] 中洋脊地形與斷層。敘述何者正確？",
                    options: [ { label: "AB", text: "包含板塊邊界、有轉形斷層" } ],
                    answer: "AB",
                    explanation: "**解析：** 中洋脊具張裂與轉形邊界。"
                },
                {
                    id: "earth_35", number: 35, type: "多選",
                    question: "氣壓隨高度變化？",
                    options: [ { label: "DE", text: "..." } ],
                    answer: "DE",
                    explanation: "**解析：** 密度與高度關係。"
                },
                {
                    id: "earth_36", number: 36, type: "多選",
                    question: "大氣氣溫與高度關係？",
                    options: [ { label: "AB", text: "最高峰在甲層、乙層主要為臭氧" } ],
                    answer: "AB",
                    explanation: "**解析：** 甲對流層，乙平流層。"
                },
                {
                    id: "earth_37", number: 37, type: "單選",
                    question: "[題組] 市政府最可能將沙放置在圖中哪個兩地點養灘？",
                    options: [ { label: "D", text: "丙丁" } ],
                    answer: "D",
                    explanation: "**解析：** 養灘需選在侵蝕區。"
                },
                {
                    id: "earth_39", number: 39, type: "單選",
                    question: "[題組] 地層剖面圖y地形名稱？",
                    options: [ { label: "B", text: "斷層崖" } ],
                    answer: "B",
                    explanation: "**解析：** 斷層錯動形成的陡崖。"
                },
                {
                    id: "earth_40", number: 40, type: "單選",
                    question: "地形作用順序？",
                    options: [ { label: "D", text: "堆積→褶曲→斷層→侵蝕" } ],
                    answer: "D",
                    explanation: "**解析：** 截切定律與疊置定律判斷。"
                },
                {
                    id: "earth_41", number: 41, type: "單選",
                    question: "冰河地形景觀最可能在何處？",
                    options: [ { label: "D", text: "高緯或高山 (如 92W, 30N 高山)" } ],
                    answer: "D",
                    explanation: "**解析：** 冰河需低溫環境。"
                },
                {
                    id: "earth_44", number: 44, type: "非選",
                    question: "租屋網顯示捷運站方圓200公尺物件，為何種GIS分析？",
                    options: [],
                    answer: "環境分析 (環域分析)",
                    explanation: "**解析：** Buffer Analysis。"
                },
                {
                    id: "earth_46", number: 46, type: "非選",
                    question: "解析度80m與2m，資料量相差幾倍？",
                    options: [],
                    answer: "0.000625 倍",
                    explanation: "**解析：** $(2/80)^2$。"
                },
                {
                    id: "earth_49", number: 49, type: "非選",
                    question: "圖中丙和丁組成的地形？",
                    options: [],
                    answer: "沙頸岬",
                    explanation: "**解析：** 陸連島+連島沙洲。"
                }
            ],

            // --- 地理 (Geography) ---
            "1_2_geo": [
                {
                    id: "geo_01", number: 1, type: "單選",
                    question: "某 APP 推出「好友靠近通知」服務，當朋友攜帶手機並進入使用者周圍特定距離範圍內時，就會觸發通知。請問此服務最有可能運用了下列哪些技術？ (甲)網路分析 (乙)區域分析 (丙)全球定位系統 (丁)衛星探測",
                    options: [ { label: "A", text: "甲乙" }, { label: "B", text: "甲丙" }, { label: "C", text: "乙丙" }, { label: "D", text: "乙丁" } ],
                    answer: "C",
                    explanation: "**解析：** 需定位使用者位置(GPS, 丙)並判斷是否進入特定距離範圍(環域分析, 乙)。"
                },
                {
                    id: "geo_02", number: 2, type: "單選",
                    question: "地理資訊系統中資料的儲存格式，有向量模式與網格模式。以下兩者的比較何者正確？",
                    options: [ { label: "D", text: "網格模式適合表現地形起伏" } ],
                    answer: "D",
                    explanation: "**解析：** 網格模式適用於連續性資料（如數值地形模型 DTM），向量模式適用於離散性資料。"
                },
                {
                    id: "geo_03", number: 3, type: "單選",
                    question: "阿豪想在 A 區置產，條件：5公里內、1000公尺範圍、30分鐘車程。請問利用 GIS 系統中的哪些分析方法？ (甲)坡度 (乙)區域 (丙)視域 (丁)疊圖",
                    options: [ { label: "D", text: "乙丁" } ],
                    answer: "D",
                    explanation: "**解析：** 距離範圍屬於區域/環域分析(乙)；整合多條件需用疊圖分析(丁)。"
                },
                {
                    id: "geo_04", number: 4, type: "單選",
                    question: "2022年俄烏戰爭，新聞報導戰爭影像。請問哪一個衛星最適合觀測細節？",
                    options: [ { label: "C", text: "QS (週期5天, 解析10m)" } ],
                    answer: "C",
                    explanation: "**解析：** 報導戰爭需要較高解析度。依試卷答案選 C。"
                },
                {
                    id: "geo_05", number: 5, type: "單選",
                    question: "根據鄉野故事(山坡地、白色泥土、白頭翁等)，當地最可能可生產下列哪二種資源？ (甲)石油 (乙)煤炭 (丙)頁岩 (丁)石灰岩",
                    options: [ { label: "B", text: "乙丙" } ],
                    answer: "B",
                    explanation: "**解析：** 根據地質描述，可能與沉積岩資源如煤炭(乙)和頁岩(丙)相關。"
                },
                {
                    id: "geo_06", number: 6, type: "單選",
                    question: "2010年二高基隆段發生山坡地滑動，目擊者：「不到5秒鐘就看到整片山坡滑動」。此現象最可能是？",
                    options: [ { label: "B", text: "地滑" } ],
                    answer: "B",
                    explanation: "**解析：** 整片岩層沿著滑動面快速下滑，符合地滑特徵。"
                },
                {
                    id: "geo_07", number: 7, type: "單選",
                    question: "關於酸性與基性熔岩的比較，何者最為合理？",
                    options: [ { label: "C", text: "酸性較易發生猛烈爆發" } ],
                    answer: "C",
                    explanation: "**解析：** 酸性熔岩黏滯性高，氣體不易散失，壓力大易形成猛烈爆發。"
                },
                {
                    id: "geo_08", number: 8, type: "單選",
                    question: "關於冰河作用的特色報告，何者最合理？",
                    options: [ { label: "B", text: "一定厚度的冰層受壓力或重力影響而移動即稱冰河" } ],
                    answer: "B",
                    explanation: "**解析：** 這是冰河的定義。"
                },
                {
                    id: "geo_09", number: 9, type: "單選",
                    question: "[需參考試卷圖表] 圖為冰河地形示意圖。就圖判斷，冰河的流向最可能是？",
                    options: [ { label: "A", text: "由東向西流" } ],
                    answer: "A",
                    explanation: "**解析：** 需觀察冰磧堤的開口方向或羊背石的陡坡方向判斷。"
                },
                {
                    id: "geo_10", number: 10, type: "單選",
                    question: "[需參考試卷圖表] 圖甲、乙為兩種海岸類型的等高線圖。關於兩者共同性敘述何者正確？",
                    options: [ { label: "D", text: "皆具有天然良港條件" } ],
                    answer: "D",
                    explanation: "**解析：** 沉水海岸(如谷灣、峽灣)水深較深，易形成天然良港。"
                },
                {
                    id: "geo_11", number: 11, type: "單選",
                    question: "下列哪兩項地形分布於沉水海岸？ (甲)潟湖外沙洲 (乙)海階 (丙)峽灣 (丁)谷灣",
                    options: [ { label: "D", text: "丙丁" } ],
                    answer: "D",
                    explanation: "**解析：** 峽灣與谷灣皆為沉水海岸特徵。"
                },
                {
                    id: "geo_12", number: 12, type: "單選",
                    question: "關於冰河堆積地形：(甲)冰磧 (乙)冰積平原 (丙)外洗平原。下列敘述何者不正確？",
                    options: [ { label: "B", text: "淘選度優劣：甲 > 丙 > 乙" } ],
                    answer: "B",
                    explanation: "**解析：** 外洗平原(丙)經水流淘選，淘選度最佳。冰磧(甲)淘選度最差。故 B 錯誤。"
                },
                {
                    id: "geo_13", number: 13, type: "單選",
                    question: "沖積扇和三角洲地形的比較，哪三項正確？",
                    options: [ { label: "C", text: "甲丙丁" } ],
                    answer: "C",
                    explanation: "**解析：** 兩者營力皆為流水堆積(甲)，顆粒大小扇>洲(丙)，災害類型正確(丁)。"
                },
                {
                    id: "geo_14", number: 14, type: "單選",
                    question: "塔爾火山 (13°N, 121°E) 頻繁噴發...請問是下列哪個國家？",
                    options: [ { label: "D", text: "菲律賓" } ],
                    answer: "D",
                    explanation: "**解析：** 根據經緯度判斷為菲律賓。"
                },
                {
                    id: "geo_15", number: 15, type: "單選",
                    question: "下列哪兩種地形因地下水湧現、水源充足，而成為聚落所在地？",
                    options: [ { label: "A", text: "沖積扇扇端，河階下方" } ],
                    answer: "A",
                    explanation: "**解析：** 沖積扇扇端為湧泉帶；河階下方也常有水源滲出。"
                },
                {
                    id: "geo_16", number: 16, type: "單選",
                    question: "有關風化作用敘述，哪二項是正確的？ (丙) 碳酸鹽岩溶作用屬化學風化；(丁) 植物根撐開裂隙屬物理風化。",
                    options: [ { label: "C", text: "丙丁" } ],
                    answer: "C",
                    explanation: "**解析：** 溶蝕是化學作用；根劈作用是物理作用。"
                },
                {
                    id: "geo_17", number: 17, type: "單選",
                    question: "[需參考試卷圖表] 圖為某地等高線圖，對於當地環境特徵描述，何者正確？",
                    options: [ { label: "B", text: "擁有大理石工業所需的原料" } ],
                    answer: "B",
                    explanation: "**解析：** 依試卷判讀，該地地形特徵與岩層特性(可能為石灰岩變質)暗示擁有大理石礦產。"
                },
                {
                    id: "geo_18", number: 18, type: "單選",
                    question: "[需參考試卷圖表] 比較80年前後的海平面/海岸線圖，海岸線變遷為何？",
                    options: [ { label: "B", text: "海岸線約後退 5 公尺" } ],
                    answer: "B",
                    explanation: "**解析：** 根據圖上比例尺測量海岸線向陸地移動的距離。"
                },
                {
                    id: "geo_19", number: 19, type: "單選",
                    question: "GIS 資料以網格與向量模式儲存，何者正確？",
                    options: [ { label: "C", text: "數值地形模型(DTM)屬於網格模式資料" } ],
                    answer: "C",
                    explanation: "**解析：** DTM 是紀錄高程的網格資料。"
                },
                {
                    id: "geo_20", number: 20, type: "單選",
                    question: "關於斯洛維尼亞喀斯特地形的推論，正確的是？(甲) 喀斯特地形；(戊) 農業排水問題。",
                    options: [ { label: "B", text: "甲戊" } ],
                    answer: "B",
                    explanation: "**解析：** 石灰岩地形滲水性強，易造成農業灌溉(保水)困難。"
                },
                {
                    id: "geo_21", number: 21, type: "單選",
                    question: "桃園台地屬於古山麓沖積扇，可蒐集到何種環境特徵？",
                    options: [ { label: "B", text: "土壤表層以較厚的黏土堆積為主" } ],
                    answer: "B",
                    explanation: "**解析：** 桃園台地表層形成紅土(黏土層)。"
                },
                {
                    id: "geo_22", number: 22, type: "單選",
                    question: "[需參考試卷圖表] 河階地形示意圖，敘述何者正確？",
                    options: [ { label: "B", text: "甲丙" } ],
                    answer: "B",
                    explanation: "**解析：** 河階面平坦且水源取得容易，適合聚落發展。"
                },
                {
                    id: "geo_23", number: 23, type: "單選",
                    question: "(概念題) 河川襲奪發生後，下列哪種地形特徵通常不會出現？",
                    options: [ { label: "D", text: "三角洲增大" } ],
                    answer: "D",
                    explanation: "**解析：** 襲奪後斷頭河流量減少，三角洲可能縮小。"
                },
                {
                    id: "geo_24", number: 24, type: "單選",
                    question: "礫漠與沙質沙漠之比較，正確的是？ (甲) 礫漠成因：風蝕；(丁) 沙漠分布：乾燥區。",
                    options: [ { label: "B", text: "甲丁" } ],
                    answer: "B",
                    explanation: "**解析：** 礫漠是風力吹蝕帶走細沙後留下的礫石地表。"
                },
                {
                    id: "geo_25", number: 25, type: "單選",
                    question: "[題組] 透過 O、T 兩點的 GPS 資訊，可推算哪些訊息？ (丙) 直線距離；(丁) 步行速度。",
                    options: [ { label: "B", text: "丙丁" } ],
                    answer: "B (或D)",
                    explanation: "**解析：** GPS 提供座標(算距離)與時間(算速度)。"
                },
                {
                    id: "geo_26", number: 26, type: "單選",
                    question: "[題組] 從 O(252000, 2687000) 到 T(257000, 2690000)，移動方向為何？",
                    options: [ { label: "B", text: "東北方" } ],
                    answer: "B",
                    explanation: "**解析：** X 增加(向東)，Y 增加(向北)，故為東北方。"
                },
                {
                    id: "geo_27", number: 27, type: "單選",
                    question: "[需參考試卷圖表] 圖中甲點座標最可能為？",
                    options: [ { label: "D", text: "(206980E, 2553900N)" } ],
                    answer: "D",
                    explanation: "**解析：** 甲點位於圖幅右上角，座標值應最大。"
                },
                {
                    id: "geo_28", number: 28, type: "單選",
                    question: "[需參考試卷圖表] 圈選區域的坡向最接近？",
                    options: [ { label: "D", text: "西南西" } ],
                    answer: "D",
                    explanation: "**解析：** 根據等高線或網格數值下降的方向判斷。"
                },
                {
                    id: "geo_29", number: 29, type: "單選",
                    question: "[需參考試卷圖表] 圖中網格解析度(X, Y間距)為？",
                    options: [ { label: "B", text: "40 公尺" } ],
                    answer: "B",
                    explanation: "**解析：** 觀察座標軸數值變化，每格差值為 40。"
                },
                {
                    id: "geo_30", number: 30, type: "單選",
                    question: "數值地形模型 (DTM) 除了算坡度坡向，還可做哪三項分析？ (甲) 區域分析；(乙) 3D 地形展示；(丁) 模擬基地台選址。",
                    options: [ { label: "B", text: "甲乙丁" } ],
                    answer: "B",
                    explanation: "**解析：** DTM 是高度資料，適合做立體展示、視域分析與地形相關的區域分析。"
                },
                {
                    id: "geo_31", number: 31, type: "單選",
                    question: "[題組] 依坡向與地表高度判斷，若本區有主要河流流經，其流向大致為何？",
                    options: [ { label: "D", text: "南 → 北" } ],
                    answer: "D",
                    explanation: "**解析：** 水往低處流，根據 DTM 數值顯示南高北低。"
                },
                {
                    id: "geo_32", number: 32, type: "單選",
                    question: "[題組] 甲~丁中哪二個住宅區位於順向坡，而易有潛在地質災害？",
                    options: [ { label: "B", text: "甲丁" } ],
                    answer: "B",
                    explanation: "**解析：** 順向坡指岩層傾斜方向與坡面方向一致。"
                },
                {
                    id: "geo_33", number: 33, type: "單選",
                    question: "設立森林遊樂區條件：林地且非保育地。若總面積16平方公里，符合條件面積約為？",
                    options: [ { label: "C", text: "8" } ],
                    answer: "C",
                    explanation: "**解析：** 疊圖分析後，符合條件區域約佔總面積的一半 (8平方公里)。"
                },
                {
                    id: "geo_34", number: 34, type: "單選",
                    question: "欲興建觀光飯店，在保護生態原則下，何處最適合？",
                    options: [ { label: "C", text: "丙" } ],
                    answer: "C",
                    explanation: "**解析：** 丙地避開了保育區與災害敏感區，且地勢適中。"
                },
                {
                    id: "geo_35", number: 35, type: "單選",
                    question: "GIS 疊圖計算：網格代碼 6 的人口為何？(行政區人口 11,000，比例 3:5:2)",
                    options: [ { label: "D", text: "6 千人" } ],
                    answer: "D",
                    explanation: "**解析：** 根據人口比例計算。"
                },
                {
                    id: "geo_36", number: 36, type: "單選",
                    question: "超商選址：人口多且地價低。最佳網格代碼是？",
                    options: [ { label: "B", text: "11" } ],
                    answer: "B",
                    explanation: "**解析：** 疊合人口圖層與地價圖層，找出交集。"
                },
                {
                    id: "geo_37", number: 37, type: "單選",
                    question: "市政府最可能將沙放置在圖中哪個兩地點，進行養灘？",
                    options: [ { label: "D", text: "丙丁" } ],
                    answer: "D",
                    explanation: "**解析：** 養灘應選在受侵蝕嚴重的海岸段。"
                },
                {
                    id: "geo_38", number: 38, type: "單選",
                    question: "風箏賽場最可能設置在何處？",
                    options: [ { label: "B", text: "乙" } ],
                    answer: "B",
                    explanation: "**解析：** 需開闊平坦且風力穩定的區域，通常在海邊空曠處。"
                },
                {
                    id: "geo_39", number: 39, type: "單選",
                    question: "[需參考試卷圖表] y 地區的地形或構造名稱為何？",
                    options: [ { label: "B", text: "斷層崖" } ],
                    answer: "B",
                    explanation: "**解析：** 斷層錯動形成的陡崖。"
                },
                {
                    id: "geo_40", number: 40, type: "單選",
                    question: "圖中地層地形作用順序？(甲)侵蝕 (乙)堆積 (丙)斷層 (丁)褶曲",
                    options: [ { label: "D", text: "乙丁丙甲" } ],
                    answer: "D",
                    explanation: "**解析：** 堆積 -> 褶曲 -> 斷層 -> 侵蝕。"
                },
                {
                    id: "geo_41", number: 41, type: "單選",
                    question: "[需參考試卷圖表] 冰河地形圖，何處最可能見到此景觀？",
                    options: [ { label: "D", text: "(92°03'W, 30°58'N) (若為高山)" } ],
                    answer: "D",
                    explanation: "**解析：** 冰河地形分布於高緯度或高海拔地區。"
                },
                {
                    id: "geo_42", number: 42, type: "單選",
                    question: "圖中冰斗地形開口朝哪個方位？",
                    options: [ { label: "B", text: "東南" } ],
                    answer: "B",
                    explanation: "**解析：** 判讀等高線，冰斗開口朝向低處。"
                },
                {
                    id: "geo_43", number: 43, type: "單選",
                    question: "若想觀賞乙區冰河地形，觀景台設在何處？",
                    options: [ { label: "B", text: "己" } ],
                    answer: "B",
                    explanation: "**解析：** 選擇視野開闊且能俯瞰目標區的高點。"
                },
                {
                    id: "geo_44", number: 44, type: "非選",
                    question: "租屋網顯示捷運站方圓 200 公尺內的物件。此為 GIS 哪項分析？",
                    options: [],
                    answer: "環境分析 (或 環域分析 Buffer)",
                    explanation: "**解析：** 環域分析 (Buffer)。"
                },
                {
                    id: "geo_45", number: 45, type: "非選",
                    question: "分析海岸與住家災害風險，主要運用 GIS 何種功能？",
                    options: [],
                    answer: "數值地形模型分析 (DTM)",
                    explanation: "**解析：** 淹水與海嘯風險需依賴 DTM。"
                },
                {
                    id: "geo_46", number: 46, type: "非選",
                    question: "解析度 80m vs 2m，資料量相差幾倍？",
                    options: [],
                    answer: "0.000625 倍",
                    explanation: "**解析：** $(2/80)^2 = 1/1600$。"
                },
                {
                    id: "geo_47", number: 47, type: "非選",
                    question: "化學風化及凍融交替作用分別盛行於？",
                    options: [],
                    answer: "乙 (高溫多雨), 丁 (低溫有水)",
                    explanation: "**解析：** 化學風化需水與熱；凍融需低溫且有水份變化。"
                },
                {
                    id: "geo_48", number: 48, type: "非選",
                    question: "圖中屬於向斜構造者？",
                    options: [],
                    answer: "乙, 丁",
                    explanation: "**解析：** 向斜構造地層向下彎曲。"
                },
                {
                    id: "geo_49", number: 49, type: "非選",
                    question: "[題組] 圖中丙和丁所組成的地形名稱？",
                    options: [],
                    answer: "沙頸岬",
                    explanation: "**解析：** 陸連島+連島沙洲。"
                },
                {
                    id: "geo_50", number: 50, type: "非選",
                    question: "「丙+丁」地形形成過程：先___再___？",
                    options: [],
                    answer: "先 堆積 再 侵蝕",
                    explanation: "**解析：** 沙洲堆積連接島嶼，後續可能受波浪侵蝕修飾。"
                }
            ],

            // --- 其他科目 (維持精選題) ---
            "1_2_math": [
                { id: "math_01", number: 1, type: "單選", question: "如附圖，直線 L1 與 L2 相交。根據圖形判斷，下列何者正確？", options: [{label:"B", text:"m₁ < 0, b₁ > 0"}], answer: "B", explanation: "斜率負，截距正。" },
                { id: "math_15", number: 15, type: "填充", question: "摺紙問題：求摺進去的三角形面積。", options: [], answer: "625/24", explanation: "利用垂直平分線求截距。" }
            ],
            "1_2_phy": [
                { id: "phy_01", number: 1, type: "單選", question: "物理學發展何者屬演繹推導？", options: [{label:"D", text:"只有丙 (牛頓)"}], answer: "D", explanation: "牛頓利用運動定律推導克卜勒定律。" }
            ],
            "1_2_bio": [
                { id: "bio_01", number: 1, type: "單選", question: "紅血球無核優勢？", options: [{label:"C", text:"增加攜氧量"}], answer: "C", explanation: "容納更多血紅素。" }
            ]
        };

        // --- 2. Components ---

        const LucideIcon = ({ name, size = 20, className = "" }) => {
            const [svgHtml, setSvgHtml] = React.useState("");
            React.useEffect(() => {
                if (window.lucide && window.lucide.icons && window.lucide.createElement) {
                    const pascalName = name.split('-').map(p => p.charAt(0).toUpperCase() + p.slice(1)).join('');
                    const iconDef = window.lucide.icons[pascalName];
                    if (iconDef) {
                        const el = window.lucide.createElement(iconDef);
                        el.setAttribute('width', size);
                        el.setAttribute('height', size);
                        if (className) el.setAttribute('class', className);
                        setSvgHtml(el.outerHTML);
                    }
                }
            }, [name, size, className]);
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="inline-flex items-center" />;
        };

        const MarkdownText = ({ text }) => {
            const [html, setHtml] = React.useState("");
            React.useEffect(() => {
                if (!text) return;
                let processed = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br/>');
                if (window.katex) {
                    processed = processed.replace(/\$\$(.*?)\$\$/g, (_, f) => katex.renderToString(f, { displayMode: true, throwOnError: false }));
                    processed = processed.replace(/\$(.*?)\$/g, (_, f) => katex.renderToString(f, { displayMode: false, throwOnError: false }));
                }
                setHtml(processed);
            }, [text]);
            return <div className="explanation-text" dangerouslySetInnerHTML={{ __html: html }} />;
        };

        const ImagePlaceholder = () => (
            <div className="my-4 p-6 bg-white border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center text-gray-400 gap-3 hover:bg-gray-50 transition-colors">
                <LucideIcon name="image" size={40} />
                <span className="text-sm font-medium tracking-wide">[ 需參考試卷圖表 ]</span>
                <span className="text-xs">請點擊下方按鈕查看原始試卷</span>
            </div>
        );

        const QuestionItem = ({ q }) => {
            const [showExp, setShowExp] = React.useState(false);
            const hasImage = q.question.includes("[需參考試卷圖表]") || q.question.includes("[需參考圖表]");

            return (
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6 hover:shadow-md transition-all duration-300">
                    <div className="flex items-start gap-4 mb-4">
                        <span className="bg-blue-600 text-white text-sm font-bold px-3 py-1 rounded-lg whitespace-nowrap mt-1 shadow-sm">
                            第 {q.number} 題
                        </span>
                        <div className="flex-1">
                            <h3 className="text-lg font-medium text-gray-800 mb-2">
                                <MarkdownText text={q.question.replace("[需參考試卷圖表]", "").replace("[需參考圖表]", "")} />
                            </h3>
                            {hasImage && <ImagePlaceholder />}
                        </div>
                    </div>

                    <div className="ml-0 md:ml-16 mb-6 space-y-3">
                        {q.options && q.options.length > 0 ? (
                            q.options.map((opt, idx) => (
                                <div key={idx} className="flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors group border border-transparent hover:border-gray-100">
                                    <div className="w-6 h-6 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center text-xs font-bold group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors">
                                        {opt.label}
                                    </div>
                                    <div className="text-gray-600 group-hover:text-gray-900 transition-colors">{opt.text}</div>
                                </div>
                            ))
                        ) : (
                            <div className="p-4 bg-gray-50 rounded-lg text-gray-500 italic text-sm border border-gray-100">
                                (本題為填充或計算題，請直接查看詳解核對答案)
                            </div>
                        )}
                    </div>

                    <div className="flex items-center justify-between border-t border-gray-100 pt-4 ml-0 md:ml-16">
                        <div className="text-sm">
                            {showExp ? (
                                <span className="text-green-600 font-bold bg-green-50 px-3 py-1 rounded-full fade-in">
                                    正確答案：{q.answer}
                                </span>
                            ) : (
                                <span className="text-gray-400 font-medium">???</span>
                            )}
                        </div>
                        <button 
                            onClick={() => setShowExp(!showExp)}
                            className={`flex items-center gap-2 px-5 py-2 rounded-lg text-sm font-bold transition-all shadow-sm ${
                                showExp 
                                ? 'bg-gray-100 text-gray-600 hover:bg-gray-200' 
                                : 'bg-blue-600 text-white hover:bg-blue-700 hover:shadow-md'
                            }`}
                        >
                            <LucideIcon name={showExp ? "eye-off" : "eye"} size={16} />
                            {showExp ? "隱藏詳解" : "顯示詳解"}
                        </button>
                    </div>

                    {showExp && (
                        <div className="mt-5 ml-0 md:ml-16 bg-blue-50/50 p-6 rounded-xl border border-blue-100 explanation-box">
                            <h4 className="flex items-center gap-2 text-blue-800 font-bold mb-3 text-sm uppercase tracking-wider">
                                <LucideIcon name="book-open" size={16} />
                                詳細解析
                            </h4>
                            <MarkdownText text={q.explanation} />
                        </div>
                    )}
                </div>
            );
        };

        const SelectionScreen = ({ onStart }) => {
            const [grade, setGrade] = React.useState(null);
            const [exam, setExam] = React.useState(null);
            const [subject, setSubject] = React.useState(null);
            const isReady = grade && exam && subject;
            
            const SUBJECT_LIST = [
                {id: 'math', name: '數學', icon: 'calculator', color: 'text-purple-600', bg: 'bg-purple-50', border: 'border-purple-200'},
                {id: 'phy', name: '物理', icon: 'zap', color: 'text-yellow-600', bg: 'bg-yellow-50', border: 'border-yellow-200'},
                {id: 'chem', name: '化學', icon: 'flask-conical', color: 'text-teal-600', bg: 'bg-teal-50', border: 'border-teal-200'},
                {id: 'bio', name: '生物', icon: 'dna', color: 'text-green-600', bg: 'bg-green-50', border: 'border-green-200'},
                {id: 'earth', name: '地科', icon: 'globe', color: 'text-blue-600', bg: 'bg-blue-50', border: 'border-blue-200'},
                {id: 'geo', name: '地理', icon: 'map', color: 'text-orange-600', bg: 'bg-orange-50', border: 'border-orange-200'}
            ];

            return (
                <div className="min-h-screen flex items-center justify-center p-6 bg-gradient-to-br from-slate-100 to-slate-200">
                    <div className="bg-white max-w-5xl w-full rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[600px]">
                        {/* Banner */}
                        <div className="bg-slate-800 p-10 md:w-1/3 flex flex-col justify-between text-white relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full blur-3xl -mr-16 -mt-16"></div>
                            <div className="relative z-10">
                                <div className="w-16 h-16 bg-white/10 rounded-2xl flex items-center justify-center mb-8 backdrop-blur-sm border border-white/20">
                                    <LucideIcon name="library" size={32} className="text-white" />
                                </div>
                                <h1 className="text-4xl font-extrabold mb-4 leading-tight">高中段考<br/><span className="text-blue-400">題庫中心</span></h1>
                                <p className="text-slate-300 text-lg">歷屆試題 • 完整解析 • 自我檢測</p>
                            </div>
                            <div className="mt-12 text-xs text-slate-400 relative z-10 font-mono">
                                System v5.0<br/>Updated: 2024.12
                            </div>
                        </div>

                        {/* Selection */}
                        <div className="p-10 md:w-2/3 flex flex-col justify-center">
                            <h2 className="text-2xl font-bold text-slate-800 mb-8 flex items-center gap-3">
                                <span className="w-1.5 h-8 bg-blue-600 rounded-full"></span>
                                請選擇測驗範圍
                            </h2>

                            <div className="space-y-8">
                                <div>
                                    <label className="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">年級 (Grade)</label>
                                    <div className="flex gap-3">
                                        {[1, 2, 3].map(g => (
                                            <button
                                                key={g}
                                                onClick={() => setGrade(g)}
                                                className={`flex-1 py-3 px-4 rounded-xl border-2 font-bold text-lg transition-all duration-200 ${
                                                    grade === g 
                                                    ? 'bg-slate-800 text-white border-slate-800 shadow-lg transform -translate-y-1' 
                                                    : 'bg-white text-slate-400 border-slate-100 hover:border-slate-300 hover:text-slate-600'
                                                }`}
                                            >
                                                {g} 年級
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">段考 (Exam)</label>
                                    <div className="flex gap-3">
                                        {[1, 2, 3].map(e => (
                                            <button
                                                key={e}
                                                onClick={() => setExam(e)}
                                                className={`flex-1 py-3 px-4 rounded-xl border-2 font-bold text-lg transition-all duration-200 ${
                                                    exam === e 
                                                    ? 'bg-slate-800 text-white border-slate-800 shadow-lg transform -translate-y-1' 
                                                    : 'bg-white text-slate-400 border-slate-100 hover:border-slate-300 hover:text-slate-600'
                                                }`}
                                            >
                                                第 {e} 次
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">科目 (Subject)</label>
                                    <div className="grid grid-cols-3 gap-3">
                                        {SUBJECT_LIST.map(s => (
                                            <button
                                                key={s.id}
                                                onClick={() => setSubject(s.id)}
                                                className={`py-3 px-2 rounded-xl border-2 text-sm font-bold transition-all duration-200 flex flex-col items-center justify-center gap-2 ${
                                                    subject === s.id 
                                                    ? 'bg-slate-800 text-white border-slate-800 shadow-lg transform -translate-y-1' 
                                                    : `bg-white text-slate-500 border-slate-100 hover:border-slate-300 hover:bg-slate-50`
                                                }`}
                                            >
                                                <LucideIcon name={s.icon} size={20} className={subject === s.id ? 'text-white' : 'text-slate-400'} />
                                                {s.name}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            <div className="mt-10">
                                <button
                                    onClick={() => isReady && onStart(grade, exam, subject)}
                                    disabled={!isReady}
                                    className={`w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition-all duration-300 ${
                                        isReady
                                        ? 'bg-blue-600 hover:bg-blue-700 text-white shadow-xl hover:shadow-2xl hover:-translate-y-1 cursor-pointer'
                                        : 'bg-slate-100 text-slate-300 cursor-not-allowed'
                                    }`}
                                >
                                    {isReady ? <><LucideIcon name="book-open-check" /> 開始練習</> : "請先完成上方選擇"}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = React.useState('select');
            const [questions, setQuestions] = React.useState([]);
            const [context, setContext] = React.useState({});

            const handleStart = (g, e, s) => {
                const key = `${g}_${e}_${s}`;
                const data = QUESTION_DATABASE[key];
                
                if (data) {
                    setQuestions(data);
                    setContext({g, e, s});
                    setView('exam');
                    window.scrollTo(0, 0);
                } else {
                    alert("目前僅開放「一年級 / 第二次段考」的各科題庫！");
                }
            };

            const getSubjectName = (sid) => {
                const map = { chem: '化學', geo: '地理', earth: '地科', bio: '生物', phy: '物理', math: '數學' };
                return map[sid] || sid;
            };

            if (view === 'select') return <SelectionScreen onStart={handleStart} />;

            const pdfLink = PDF_LINKS[`${context.g}_${context.e}_${context.s}`];

            return (
                <div className="min-h-screen bg-slate-50 pb-20">
                    {/* Sticky Header */}
                    <div className="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50 px-6 py-4 shadow-sm flex justify-between items-center">
                        <div className="flex items-center gap-4">
                            <button 
                                onClick={() => setView('select')}
                                className="p-2 hover:bg-slate-100 rounded-full text-slate-500 transition-colors"
                            >
                                <LucideIcon name="arrow-left" />
                            </button>
                            <div>
                                <h1 className="font-bold text-slate-800 text-lg flex items-center gap-2">
                                    {getSubjectName(context.s)} 
                                    <span className="text-slate-400 font-normal text-sm">題庫解析</span>
                                </h1>
                            </div>
                        </div>
                        <div className="flex items-center gap-3">
                            {pdfLink && pdfLink !== '#' && (
                                <a 
                                    href={pdfLink} 
                                    target="_blank" 
                                    rel="noopener noreferrer" 
                                    className="hidden md:flex items-center gap-2 px-4 py-2 bg-red-50 text-red-600 border border-red-100 rounded-full text-sm font-bold hover:bg-red-600 hover:text-white transition-all shadow-sm"
                                >
                                    <LucideIcon name="file-text" size={16} /> 
                                    原始試卷
                                </a>
                            )}
                            <div className="text-sm font-bold text-blue-600 bg-blue-50 px-4 py-2 rounded-full border border-blue-100">
                                {questions.length} 題
                            </div>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="max-w-3xl mx-auto p-6 md:p-8">
                        {questions.map((q, idx) => (
                            <QuestionItem key={q.id} q={q} />
                        ))}
                        
                        {/* Bottom Action Area */}
                        <div className="mt-16 mb-20 space-y-6">
                            {pdfLink && pdfLink !== '#' && (
                                <div className="p-8 bg-white border border-slate-200 rounded-2xl text-center shadow-lg transform hover:-translate-y-1 transition-all duration-300">
                                    <div className="w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <LucideIcon name="file-question" size={24} />
                                    </div>
                                    <h3 className="font-bold text-slate-800 text-lg mb-2">需要對照原始圖表？</h3>
                                    <p className="text-slate-500 mb-6 max-w-md mx-auto">
                                        部分題目包含複雜圖表或地圖，建議您下載原始試卷 PDF 檔案以獲得最佳閱讀體驗。
                                    </p>
                                    <a 
                                        href={pdfLink} 
                                        target="_blank" 
                                        rel="noopener noreferrer" 
                                        className="inline-flex items-center gap-2 px-8 py-3 bg-slate-900 text-white rounded-xl font-bold hover:bg-blue-600 transition-colors shadow-md"
                                    >
                                        <LucideIcon name="download" size={18} /> 
                                        下載 / 查看原始試卷
                                    </a>
                                </div>
                            )}

                            <div className="text-center">
                                <button 
                                    onClick={() => window.scrollTo({top: 0, behavior: 'smooth'})}
                                    className="text-slate-400 hover:text-slate-600 text-sm font-medium flex items-center justify-center gap-2 mx-auto py-4"
                                >
                                    <LucideIcon name="arrow-up-circle" size={16} />
                                    回到頂部
                                </button>
                                <div className="text-slate-300 text-sm mt-4">
                                    - 試題結束 -
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
