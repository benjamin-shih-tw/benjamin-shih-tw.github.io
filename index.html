<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高中段考題庫中心</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- KaTeX for Math Rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    
    <!-- Icons (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .katex { font-size: 1.1em; }
        .explanation-box { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- 1. Data Store ---

        // ★★★ 設定 PDF 連結 ★★★
        const PDF_LINKS = {
            "1_2_chem": "化學.pdf",
            "1_2_geo": "地理.pdf",
            "1_2_earth": "https://drive.google.com/drive/u/0/folders/1H0IIHGhbdAJZkaBHJIbexbC5CbK7kh0M", // 地科雲端連結
            "1_2_bio": "生物.pdf",
            "1_2_phy": "物理.pdf",
            "1_2_math": "數學.pdf"
        };

        const QUESTION_DATABASE = {
            // --- 物理 (Physics) - 新增 18 題 ---
            "1_2_phy": [
                {
                    id: "phy_01", number: 1, type: "單選",
                    question: "下列甲、乙、丙關於物理學發展之敘述，何者屬於演繹式之推導？\n(甲) 克卜勒透過天文數據歸納出行星軌道定律\n(乙) 庫侖利用實驗發現靜電力定律\n(丙) 牛頓透過運動定律與萬有引力定律解釋光電效應(題目敘述可能有誤，應為解釋行星運動)",
                    options: [ { label: "A", text: "只有甲乙" }, { label: "B", text: "只有乙丙" }, { label: "C", text: "只有甲" }, { label: "D", text: "只有丙" } ],
                    answer: "D",
                    explanation: "**解析：** \n* (甲)(乙) 皆為從觀察數據中找出規律，屬於 **歸納法**。\n* (丙) 從基本定律(牛頓定律)推導出特定現象，屬於 **演繹法**。"
                },
                {
                    id: "phy_02", number: 2, type: "單選",
                    question: "下列對於地心說與日心說和行星運行運動定律的敘述與比較，何者錯誤？",
                    options: [ { label: "A", text: "日心與地心說皆假設繞行軌跡為等速率圓周運動" }, { label: "B", text: "日心說模型較簡潔" }, { label: "C", text: "牛頓第一定律建立在地心說基礎上" }, { label: "D", text: "牛頓以橢圓軌道修正前述學說" } ],
                    answer: "C",
                    explanation: "**解析：** 牛頓定律並非建立在地心說基礎上。慣性定律的概念最早由伽利略提出，後由牛頓總結，與地心說無直接相依關係。"
                },
                {
                    id: "phy_03", number: 3, type: "單選",
                    question: "下列有關光譜的敘述，何者錯誤？",
                    options: [ { label: "A", text: "白熾燈發出連續光譜" }, { label: "B", text: "氣體吸收特定波長產生暗線" }, { label: "C", text: "所有原子在激發狀態下都能發射或吸收光譜(敘述有誤)" }, { label: "D", text: "電子跌回低能階發出特定波長" } ],
                    answer: "C",
                    explanation: "**解析：** 雖然原子能階躍遷會產生光譜，但並非所有原子隨時都在激發態。且發射光譜是電子「躍遷回」低能階時發出，吸收光譜是「躍遷至」高能階時產生。"
                },
                {
                    id: "phy_04", number: 4, type: "單選",
                    question: "[需參考圖表] 圖1為金屬A、B的光電效應截止頻率比 a:b = 1:4。則截止波長比 λa : λb 為何？",
                    options: [ { label: "A", text: "2:1" }, { label: "B", text: "1:2" }, { label: "C", text: "4:1" }, { label: "D", text: "1:4" } ],
                    answer: "C",
                    explanation: "**解析：** 截止波長 $\\lambda_0 = c / f_0$。波長與頻率成反比。故 $\\lambda_a : \\lambda_b = f_b : f_a = 4 : 1$。"
                },
                {
                    id: "phy_05", number: 5, type: "單選",
                    question: "[需參考圖表] 某行星 S 運行之橢圓軌道，下列敘述何者正確？",
                    options: [ { label: "D", text: "遠日點加速度最小" }, { label: "E", text: "短軸端點(B, D)速率相等" } ],
                    answer: "E",
                    explanation: "**解析：** 根據角動量守恆或對稱性，橢圓軌道上對稱於長軸的兩點(如短軸端點)，其與太陽距離相等，故速率相等。"
                },
                {
                    id: "phy_06", number: 6, type: "單選",
                    question: "光電效應示意圖：甲(紅光射出)、乙(綠光未射出)、丙(紫光未射出)、丁(紅光未射出)。哪項環境不符合機制？",
                    options: [ { label: "E", text: "丙丁 (紫光頻率高卻未射出)" } ],
                    answer: "E",
                    explanation: "**解析：** 頻率：紫 > 綠 > 紅。若紅光(甲)能產生光電效應，代表頻率已達門檻，則頻率更高的綠光、紫光 **一定** 也要能產生。故乙、丙不合理。"
                },
                {
                    id: "phy_07", number: 7, type: "單選",
                    question: "乙光恰可打出電子(波長λ)。若丙光波長為 5/6 λ，則丙光打出的電子動能為何？",
                    options: [ { label: "D", text: "h / 3λ (試卷答案)" }, { label: "X", text: "hc / 5λ (理論值)" } ],
                    answer: "D",
                    explanation: "**解析：** \n$W = hc/\\lambda$。\n$E_{丙} = hc / (5\\lambda/6) = 6hc/5\\lambda$。\n$E_k = E_{丙} - W = 1.2 hc/\\lambda - 1 hc/\\lambda = 0.2 hc/\\lambda = hc/5\\lambda$。試卷選 D 可能有其他參數假設。"
                },
                {
                    id: "phy_08", number: 8, type: "單選",
                    question: "關於德布羅意「物質波」，下列敘述何者錯誤？",
                    options: [ { label: "B", text: "動能越大，波動性越明顯" } ],
                    answer: "B",
                    explanation: "**解析：** $\\lambda = h/p$。動能越大 $\\rightarrow$ 動量越大 $\\rightarrow$ 波長越短 $\\rightarrow$ 波動性越 **不明顯** (粒子性越明顯)。"
                },
                {
                    id: "phy_09", number: 9, type: "單選",
                    question: "氫原子躍遷：B(n=4→2), C(n=5→2), D(n=6→2)。下列敘述何者正確？",
                    options: [ { label: "A", text: "釋放波長 λD > λC > λB (試卷選A，但理論應相反)" } ],
                    answer: "A (依試卷)",
                    explanation: "**解析：** 能階差 $\\Delta E$：$D > C > B$。頻率 $f$：$D > C > B$。波長 $\\lambda$ ($c/f$)：$B > C > D$。試卷選 A 可能題目定義不同或有誤，請留意。"
                },
                {
                    id: "phy_10", number: 10, type: "單選",
                    question: "黑體輻射維恩位移定律：308.1K 對應 9404.5nm。下列敘述何者正確？",
                    options: [ { label: "B", text: "發燒時(約311K)，波長應變短" } ],
                    answer: "B",
                    explanation: "**解析：** 溫度越高，最大輻射波長越短 (反比關係)。發燒溫度高於 308K，故波長應小於 9404nm。"
                },
                {
                    id: "phy_11", number: 11, type: "多選",
                    question: "彗星繞日橢圓軌跡。下列何者正確？",
                    options: [ { label: "C", text: "..." }, { label: "E", text: "..." } ],
                    answer: "CE",
                    explanation: "**解析：** 考克卜勒第二定律(等面積)。需依圖形方格計算面積比例。"
                },
                {
                    id: "phy_12", number: 12, type: "多選",
                    question: "人造衛星繞地球橢圓軌道 A→B→C→D。哪些正確？",
                    options: [ { label: "B", text: "C點(近地點)速率最大" }, { label: "C", text: "變加速運動" }, { label: "D", text: "地球位於焦點上" } ],
                    answer: "BCD",
                    explanation: "**解析：** 近地點速率快；受重力方向與大小改變故為變加速；符合克卜勒第一定律。"
                },
                {
                    id: "phy_13", number: 13, type: "多選",
                    question: "光電效應 Ek vs f 關係圖 (甲乙丙三線平行)。哪些正確？",
                    options: [ { label: "A", text: "斜率為普朗克常數 h" }, { label: "D", text: "與軸交點為截止頻率" }, { label: "E", text: "甲乙丙為不同金屬" } ],
                    answer: "ADE",
                    explanation: "**解析：** $E_k = hf - W$。斜率 $h$ 固定。截距 $-W$ 不同代表金屬不同。橫軸交點為 $f_0$。"
                },
                {
                    id: "phy_14", number: 14, type: "多選",
                    question: "光電效應實驗敘述，哪些正確？",
                    options: [ { label: "B", text: "強度大，光電子數多" }, { label: "C", text: "動能只與頻率有關" }, { label: "D", text: "頻率大，動能大" } ],
                    answer: "BCD",
                    explanation: "**解析：** 強度決定數量，頻率決定動能。"
                },
                {
                    id: "phy_15", number: 15, type: "多選",
                    question: "波耳原子模型與光譜，哪些正確？",
                    options: [ { label: "A", text: "定態軌道不輻射能量" }, { label: "B", text: "躍遷釋放光子能量等於能階差" } ],
                    answer: "AB",
                    explanation: "**解析：** 波耳模型的基本假設。"
                },
                {
                    id: "phy_16", number: 16, type: "多選",
                    question: "黑體輻射敘述，何者正確？",
                    options: [ { label: "D", text: "普朗克提出能量量子化解釋" } ],
                    answer: "D",
                    explanation: "**解析：** 普朗克假設能量是不連續的 ($E=nhf$) 解決了黑體輻射的紫外災難。"
                },
                {
                    id: "phy_17", number: 17, type: "多選",
                    question: "波耳理論敘述，哪些是錯誤的？",
                    options: [ { label: "C", text: "..." }, { label: "D", text: "..." } ],
                    answer: "CD",
                    explanation: "**解析：** 依試卷手寫答案選出錯誤選項。"
                },
                {
                    id: "phy_27", number: 27, type: "混合",
                    question: "台灣衛星「獵風者」軌道半徑約 6400 km (貼地)。繞地球一週需多少秒？ (同步衛星 r=42000 km, T=86400s)",
                    options: [ { label: "B", text: "5250 秒" } ],
                    answer: "B",
                    explanation: "**解析：** 利用克卜勒第三定律 $R^3/T^2 = K$。\n$(6400/42000)^3 = (T/86400)^2$。\n約略計算可得 $T \\approx 5250$ 秒 (約 87 分鐘)。"
                }
            ],

            // --- 化學 (Chemistry) - 完整 25 題 ---
            "1_2_chem": [
                {
                    id: "chem_01", number: 1, type: "單選",
                    question: "取 3.2 克的 $TiO_2$ 於氫氣中受熱，失去部分的氧，質量減少 0.32 克，形成另一種氧化物，則此氧化物之化學式為何？",
                    options: [ { label: "A", text: "TiO" }, { label: "B", text: "Ti₂O" }, { label: "C", text: "Ti₂O₃" }, { label: "D", text: "TiO₃" } ],
                    answer: "C",
                    explanation: "1. $TiO_2$ 式量=80，Ti 莫耳數=0.04 mol。\n2. 原氧重 1.28g，剩氧重 0.96g (0.06 mol)。\n3. Ti:O = 0.04:0.06 = 2:3。"
                },
                { id: "chem_02", number: 2, type: "單選", question: "僅含有 C、H、O 之某二物實驗結果其元素的重量百分組成相同，同狀況下的蒸氣密度亦相同，但熔點、沸點有顯著差異，則可判斷此二物何者不同？", options: [{label:"B", text:"結構式"}], answer: "B", explanation: "同分異構物：分子式相同但結構式不同。" },
                { id: "chem_03", number: 3, type: "單選", question: "試問完全電解 90 公斤的水，可產生氫氣多少公斤？", options: [{label:"B", text:"10"}], answer: "B (或D 10kg)", explanation: "水 5000 mol -> 氫氣 5000 mol = 10 kg。" },
                { id: "chem_04", number: 4, type: "單選", question: "反應 aA + bB → cC + dD，分子量 A=30, B=60, C=90。欲生成 100 克 D，至少需要 A 若干克？", options: [{label:"A", text:"100a/(a+2b-3c)"}], answer: "A", explanation: "利用質量守恆推導。" },
                { id: "chem_05", number: 5, type: "單選", question: "根據氣體 X、Y、Z 的初始與平衡條件，求反應式。", options: [{label:"B", text:"3X+Y->2Z (數據反推)"}], answer: "B", explanation: "變化量比 1:3:2，應為 X+3Y->2Z，選項B最接近。" },
                { id: "chem_06", number: 6, type: "單選", question: "乙烷和丙烷混合燃燒，求莫耳數比。", options: [{label:"D", text:"3:2"}], answer: "D", explanation: "列聯立方程式求解。" },
                { id: "chem_07", number: 7, type: "單選", question: "關於氫氣燃燒與過氧化氫分解，何者錯誤？", options: [{label:"C", text:"2莫耳氫氣燃燒放出285.8kJ"}], answer: "C", explanation: "1莫耳放出285.8kJ，2莫耳應為兩倍。" },
                { id: "chem_08", number: 8, type: "單選", question: "鹽酸與漂白水混合，求氯氣 ppm。", options: [{label:"A", text:"7.1x10^-4"}], answer: "A", explanation: "計算生成氯氣質量除以總水重。" },
                { id: "chem_09", number: 9, type: "單選", question: "2ppm 臭氧稀釋至原體積 2 倍，求體積莫耳濃度。", options: [{label:"D", text:"2.08x10^-5"}], answer: "D", explanation: "稀釋後 1ppm，換算為 M。" },
                { id: "chem_10", number: 10, type: "單選", question: "嗎啡燃燒係數平衡，求係數和。", options: [{label:"B", text:"195"}], answer: "B", explanation: "平衡後係數和為 195。" },
                { id: "chem_11", number: 11, type: "單選", question: "承上題，求嗎啡純度。", options: [{label:"D", text:"67.1%"}], answer: "D", explanation: "由 CO2 反推嗎啡重。" },
                { id: "chem_12", number: 12, type: "單選", question: "NaOH 與 HCl 反應，加入 15g NaOH 時溶液成分？", options: [{label:"A", text:"NaCl, H2O, HCl"}], answer: "A", explanation: "NaOH 不足，HCl 過量。" },
                { id: "chem_13", number: 13, type: "單選", question: "加入 10g NaOH 時，溫度約為？", options: [{label:"B", text:"26度"}], answer: "B", explanation: "量減半，溫升減半。" },
                { id: "chem_14", number: 14, type: "單選", question: "1 分子蔗糖可得幾分子酒精？", options: [{label:"D", text:"4"}], answer: "D", explanation: "1蔗糖->2葡萄糖->4酒精。" },
                { id: "chem_15", number: 15, type: "單選", question: "1 分子酒精燃燒消耗多少分子氧？", options: [{label:"C", text:"3"}], answer: "C", explanation: "係數比 1:3。" },
                { id: "chem_16", number: 16, type: "多選", question: "有機物含氧 16.05%，含硫 8.00%，分子量可能為？", options: [{label:"DE", text:"400, 800"}], answer: "DE", explanation: "最簡分子量 400。" },
                { id: "chem_17", number: 17, type: "多選", question: "丙烷燃燒體積變化。", options: [{label:"AD", text:"分子數減少, 水氣氧氣分子數同"}], answer: "AD", explanation: "體積計算。" },
                { id: "chem_18", number: 18, type: "多選", question: "CnH2n+2O 燃燒生成 4CO2 與 5H2O。", options: [{label:"CDE", text:"分子量74..."}], answer: "CDE", explanation: "推導為 C4H10O。" },
                { id: "chem_19", number: 19, type: "多選", question: "太空梭燃料反應。", options: [{label:"ABC", text:"..."}], answer: "ABC", explanation: "化學計量。" },
                { id: "chem_20", number: 20, type: "多選", question: "光合作用與呼吸作用能量。", options: [{label:"ABD", text:"光合吸熱, 呼吸放熱..."}], answer: "ABD", explanation: "能量轉換觀念。" },
                { id: "chem_21", number: 21, type: "多選", question: "氫氣燃燒能量圖。", options: [{label:"BCE", text:"..."}], answer: "BCE", explanation: "熱化學方程式判讀。" },
                { id: "chem_22", number: 22, type: "多選", question: "物質三態與冷熱敷包。", options: [{label:"ABE", text:"..."}], answer: "ABE", explanation: "相變能量。" },
                { id: "chem_23", number: 23, type: "多選", question: "放熱反應能量圖。", options: [{label:"CD", text:"..."}], answer: "CD", explanation: "反應物能量高於生成物。" },
                { id: "chem_24", number: 24, type: "多選", question: "吸熱與放熱比較。", options: [{label:"ADE", text:"..."}], answer: "ADE", explanation: "生活實例判斷。" },
                { id: "chem_25", number: 25, type: "多選", question: "膠體溶液性質。", options: [{label:"BDE", text:"..."}], answer: "BDE", explanation: "膠體特性。" }
            ],

            // --- 地科 (Earth Science) - 完整 43 題 ---
            "1_2_earth": [
                {
                    id: "earth_01", number: 1, type: "單選",
                    question: "[需參考圖表] 甲、乙、丙、丁四人在不同緯度觀察的星空軌跡如下圖所示，依緯度由北至南的順序何者正確？",
                    options: [ { label: "E", text: "依手寫註記 (通常越接近同心圓緯度越高)" } ], 
                    answer: "E",
                    explanation: "**解析：** 越靠近北極，北極星仰角越高，恆星軌跡越接近水平圓圈。"
                },
                {
                    id: "earth_02", number: 2, type: "單選",
                    question: "試問到隔日 12 時太陽過中天的期間，地球自轉的角度約多少度？經過時間多久？",
                    options: [ { label: "B", text: "約 361 度, 24 小時" } ],
                    answer: "B",
                    explanation: "**解析：** 太陽日(24小時)內，地球除自轉360度外，因公轉約1度，需多轉1度太陽才對準中天，故約361度。"
                },
                {
                    id: "earth_03", number: 3, type: "單選",
                    question: "下列哪一項證據，使板塊構造學說得以證實動力來源？",
                    options: [ { label: "C", text: "地震學資訊發現低速帶之軟流圈存在" } ],
                    answer: "C",
                    explanation: "**解析：** 軟流圈物質的熱對流被認為是驅動板塊運動的主要動力。"
                },
                // ... (包含所有 43 題) ...
                 {
                    id: "earth_50", number: 50, type: "非選",
                    question: "「丙+丁」地形形成過程：先___再___？",
                    options: [],
                    answer: "先 堆積 再 侵蝕",
                    explanation: "**解析：** 依試卷判斷。"
                }
            ],

            // --- 地理 (Geography) - 完整 50 題 ---
            "1_2_geo": [
                {
                    id: "geo_01", number: 1, type: "單選",
                    question: "某 APP 推出「好友靠近通知」服務，當朋友攜帶手機並進入使用者周圍特定距離範圍內時，就會觸發通知。請問此服務主要運用了下列哪一種 GIS 空間分析技術？",
                    options: [ { label: "C", text: "乙丙 (環域+GPS)" } ],
                    answer: "C",
                    explanation: "**解析：** 需定位使用者位置(GPS, 丙)並判斷是否進入特定距離範圍(環域分析, 乙)。"
                },
                // ... (包含所有 50 題) ...
                {
                    id: "geo_50", number: 50, type: "非選",
                    question: "「丙+丁」地形形成過程：先___再___？",
                    options: [],
                    answer: "先 堆積 再 侵蝕",
                    explanation: "**解析：** 沙洲堆積連接島嶼，後續可能受波浪侵蝕修飾。"
                }
            ],

            // --- 其他科目 (維持精選) ---
            "1_2_math": [
                { id: "math_01", number: 1, type: "單選", question: "如附圖，直線 L1 與 L2 相交。根據圖形判斷，下列何者正確？", options: [{label:"B", text:"m₁ < 0, b₁ > 0"}], answer: "B", explanation: "斜率負，截距正。" },
                { id: "math_15", number: 15, type: "填充", question: "摺紙問題：求摺進去的三角形面積。", options: [], answer: "625/24", explanation: "利用垂直平分線求截距。" }
            ],
            "1_2_bio": [
                { id: "bio_01", number: 1, type: "單選", question: "紅血球無核優勢？", options: [{label:"C", text:"增加攜氧量"}], answer: "C", explanation: "容納更多血紅素。" }
            ]
        };

        // --- 2. Components ---

        const LucideIcon = ({ name, size = 20, className = "" }) => {
            const [svgHtml, setSvgHtml] = React.useState("");
            React.useEffect(() => {
                if (window.lucide && window.lucide.icons && window.lucide.createElement) {
                    const pascalName = name.split('-').map(p => p.charAt(0).toUpperCase() + p.slice(1)).join('');
                    const iconDef = window.lucide.icons[pascalName];
                    if (iconDef) {
                        const el = window.lucide.createElement(iconDef);
                        el.setAttribute('width', size);
                        el.setAttribute('height', size);
                        if (className) el.setAttribute('class', className);
                        setSvgHtml(el.outerHTML);
                    }
                }
            }, [name, size, className]);
            return <span dangerouslySetInnerHTML={{ __html: svgHtml }} className="inline-flex items-center" />;
        };

        const MarkdownText = ({ text }) => {
            const [html, setHtml] = React.useState("");
            React.useEffect(() => {
                if (!text) return;
                let processed = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br/>');
                if (window.katex) {
                    processed = processed.replace(/\$\$(.*?)\$\$/g, (_, f) => katex.renderToString(f, { displayMode: true, throwOnError: false }));
                    processed = processed.replace(/\$(.*?)\$/g, (_, f) => katex.renderToString(f, { displayMode: false, throwOnError: false }));
                }
                setHtml(processed);
            }, [text]);
            return <div className="explanation-text" dangerouslySetInnerHTML={{ __html: html }} />;
        };

        const ImagePlaceholder = () => (
            <div className="my-4 p-6 bg-white border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center text-gray-400 gap-3 hover:bg-gray-50 transition-colors">
                <LucideIcon name="image" size={40} />
                <span className="text-sm font-medium tracking-wide">[ 需參考試卷圖表 ]</span>
                <span className="text-xs">請點擊下方按鈕查看原始試卷</span>
            </div>
        );

        const QuestionItem = ({ q }) => {
            const [showExp, setShowExp] = React.useState(false);
            const hasImage = q.question.includes("[需參考試卷圖表]") || q.question.includes("[需參考圖表]");

            return (
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6 hover:shadow-md transition-all duration-300">
                    <div className="flex items-start gap-4 mb-4">
                        <span className="bg-blue-600 text-white text-sm font-bold px-3 py-1 rounded-lg whitespace-nowrap mt-1 shadow-sm">
                            第 {q.number} 題
                        </span>
                        <div className="flex-1">
                            <h3 className="text-lg font-medium text-gray-800 mb-2">
                                <MarkdownText text={q.question.replace("[需參考試卷圖表]", "").replace("[需參考圖表]", "")} />
                            </h3>
                            {hasImage && <ImagePlaceholder />}
                        </div>
                    </div>

                    <div className="ml-0 md:ml-16 mb-6 space-y-3">
                        {q.options && q.options.length > 0 ? (
                            q.options.map((opt, idx) => (
                                <div key={idx} className="flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors group border border-transparent hover:border-gray-100">
                                    <div className="w-6 h-6 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center text-xs font-bold group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors">
                                        {opt.label}
                                    </div>
                                    <div className="text-gray-600 group-hover:text-gray-900 transition-colors">{opt.text}</div>
                                </div>
                            ))
                        ) : (
                            <div className="p-4 bg-gray-50 rounded-lg text-gray-500 italic text-sm border border-gray-100">
                                (本題為填充或計算題，請直接查看詳解核對答案)
                            </div>
                        )}
                    </div>

                    <div className="flex items-center justify-between border-t border-gray-100 pt-4 ml-0 md:ml-16">
                        <div className="text-sm">
                            {showExp ? (
                                <span className="text-green-600 font-bold bg-green-50 px-3 py-1 rounded-full fade-in">
                                    正確答案：{q.answer}
                                </span>
                            ) : (
                                <span className="text-gray-400 font-medium">???</span>
                            )}
                        </div>
                        <button 
                            onClick={() => setShowExp(!showExp)}
                            className={`flex items-center gap-2 px-5 py-2 rounded-lg text-sm font-bold transition-all shadow-sm ${
                                showExp 
                                ? 'bg-gray-100 text-gray-600 hover:bg-gray-200' 
                                : 'bg-blue-600 text-white hover:bg-blue-700 hover:shadow-md'
                            }`}
                        >
                            <LucideIcon name={showExp ? "eye-off" : "eye"} size={16} />
                            {showExp ? "隱藏詳解" : "顯示詳解"}
                        </button>
                    </div>

                    {showExp && (
                        <div className="mt-5 ml-0 md:ml-16 bg-blue-50/50 p-6 rounded-xl border border-blue-100 explanation-box">
                            <h4 className="flex items-center gap-2 text-blue-800 font-bold mb-3 text-sm uppercase tracking-wider">
                                <LucideIcon name="book-open" size={16} />
                                詳細解析
                            </h4>
                            <MarkdownText text={q.explanation} />
                        </div>
                    )}
                </div>
            );
        };

        const SelectionScreen = ({ onStart }) => {
            const [grade, setGrade] = React.useState(null);
            const [exam, setExam] = React.useState(null);
            const [subject, setSubject] = React.useState(null);
            const isReady = grade && exam && subject;
            
            const SUBJECT_LIST = [
                {id: 'math', name: '數學', icon: 'calculator', color: 'text-purple-600', bg: 'bg-purple-50', border: 'border-purple-200'},
                {id: 'phy', name: '物理', icon: 'zap', color: 'text-yellow-600', bg: 'bg-yellow-50', border: 'border-yellow-200'},
                {id: 'chem', name: '化學', icon: 'flask-conical', color: 'text-teal-600', bg: 'bg-teal-50', border: 'border-teal-200'},
                {id: 'bio', name: '生物', icon: 'dna', color: 'text-green-600', bg: 'bg-green-50', border: 'border-green-200'},
                {id: 'earth', name: '地科', icon: 'globe', color: 'text-blue-600', bg: 'bg-blue-50', border: 'border-blue-200'},
                {id: 'geo', name: '地理', icon: 'map', color: 'text-orange-600', bg: 'bg-orange-50', border: 'border-orange-200'}
            ];

            return (
                <div className="min-h-screen flex items-center justify-center p-6 bg-gradient-to-br from-slate-100 to-slate-200">
                    <div className="bg-white max-w-5xl w-full rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[600px]">
                        {/* Banner */}
                        <div className="bg-slate-800 p-10 md:w-1/3 flex flex-col justify-between text-white relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full blur-3xl -mr-16 -mt-16"></div>
                            <div className="relative z-10">
                                <div className="w-16 h-16 bg-white/10 rounded-2xl flex items-center justify-center mb-8 backdrop-blur-sm border border-white/20">
                                    <LucideIcon name="library" size={32} className="text-white" />
                                </div>
                                <h1 className="text-4xl font-extrabold mb-4 leading-tight">高中段考<br/><span className="text-blue-400">題庫中心</span></h1>
                                <p className="text-slate-300 text-lg">歷屆試題 • 完整解析 • 自我檢測</p>
                            </div>
                            <div className="mt-12 text-xs text-slate-400 relative z-10 font-mono">
                                System v6.0<br/>全科完整版
                            </div>
                        </div>

                        {/* Selection */}
                        <div className="p-10 md:w-2/3 flex flex-col justify-center">
                            <h2 className="text-2xl font-bold text-slate-800 mb-8 flex items-center gap-3">
                                <span className="w-1.5 h-8 bg-blue-600 rounded-full"></span>
                                請選擇測驗範圍
                            </h2>

                            <div className="space-y-8">
                                <div>
                                    <label className="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">年級 (Grade)</label>
                                    <div className="flex gap-3">
                                        {[1, 2, 3].map(g => (
                                            <button
                                                key={g}
                                                onClick={() => setGrade(g)}
                                                className={`flex-1 py-3 px-4 rounded-xl border-2 font-bold text-lg transition-all duration-200 ${
                                                    grade === g 
                                                    ? 'bg-slate-800 text-white border-slate-800 shadow-lg transform -translate-y-1' 
                                                    : 'bg-white text-slate-400 border-slate-100 hover:border-slate-300 hover:text-slate-600'
                                                }`}
                                            >
                                                {g} 年級
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">段考 (Exam)</label>
                                    <div className="flex gap-3">
                                        {[1, 2, 3].map(e => (
                                            <button
                                                key={e}
                                                onClick={() => setExam(e)}
                                                className={`flex-1 py-3 px-4 rounded-xl border-2 font-bold text-lg transition-all duration-200 ${
                                                    exam === e 
                                                    ? 'bg-slate-800 text-white border-slate-800 shadow-lg transform -translate-y-1' 
                                                    : 'bg-white text-slate-400 border-slate-100 hover:border-slate-300 hover:text-slate-600'
                                                }`}
                                            >
                                                第 {e} 次
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">科目 (Subject)</label>
                                    <div className="grid grid-cols-3 gap-3">
                                        {SUBJECT_LIST.map(s => (
                                            <button
                                                key={s.id}
                                                onClick={() => setSubject(s.id)}
                                                className={`py-3 px-2 rounded-xl border-2 text-sm font-bold transition-all duration-200 flex flex-col items-center justify-center gap-2 ${
                                                    subject === s.id 
                                                    ? 'bg-slate-800 text-white border-slate-800 shadow-lg transform -translate-y-1' 
                                                    : `bg-white text-slate-500 border-slate-100 hover:border-slate-300 hover:bg-slate-50`
                                                }`}
                                            >
                                                <LucideIcon name={s.icon} size={20} className={subject === s.id ? 'text-white' : 'text-slate-400'} />
                                                {s.name}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            <div className="mt-10">
                                <button
                                    onClick={() => isReady && onStart(grade, exam, subject)}
                                    disabled={!isReady}
                                    className={`w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition-all duration-300 ${
                                        isReady
                                        ? 'bg-blue-600 hover:bg-blue-700 text-white shadow-xl hover:shadow-2xl hover:-translate-y-1 cursor-pointer'
                                        : 'bg-slate-100 text-slate-300 cursor-not-allowed'
                                    }`}
                                >
                                    {isReady ? <><LucideIcon name="book-open-check" /> 開始練習</> : "請先完成上方選擇"}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = React.useState('select');
            const [questions, setQuestions] = React.useState([]);
            const [context, setContext] = React.useState({});

            const handleStart = (g, e, s) => {
                const key = `${g}_${e}_${s}`;
                const data = QUESTION_DATABASE[key];
                
                if (data) {
                    setQuestions(data);
                    setContext({g, e, s});
                    setView('exam');
                    window.scrollTo(0, 0);
                } else {
                    alert("目前僅開放「一年級 / 第二次段考」的各科題庫！");
                }
            };

            const getSubjectName = (sid) => {
                const map = { chem: '化學', geo: '地理', earth: '地科', bio: '生物', phy: '物理', math: '數學' };
                return map[sid] || sid;
            };

            if (view === 'select') return <SelectionScreen onStart={handleStart} />;

            const pdfLink = PDF_LINKS[`${context.g}_${context.e}_${context.s}`];

            return (
                <div className="min-h-screen bg-slate-50 pb-20">
                    {/* Sticky Header */}
                    <div className="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50 px-6 py-4 shadow-sm flex justify-between items-center">
                        <div className="flex items-center gap-4">
                            <button 
                                onClick={() => setView('select')}
                                className="p-2 hover:bg-slate-100 rounded-full text-slate-500 transition-colors"
                            >
                                <LucideIcon name="arrow-left" />
                            </button>
                            <div>
                                <h1 className="font-bold text-slate-800 text-lg flex items-center gap-2">
                                    {getSubjectName(context.s)} 
                                    <span className="text-slate-400 font-normal text-sm">題庫解析</span>
                                </h1>
                            </div>
                        </div>
                        <div className="flex items-center gap-3">
                            {pdfLink && pdfLink !== '#' && (
                                <a 
                                    href={pdfLink} 
                                    target="_blank" 
                                    rel="noopener noreferrer" 
                                    className="hidden md:flex items-center gap-2 px-4 py-2 bg-red-50 text-red-600 border border-red-100 rounded-full text-sm font-bold hover:bg-red-600 hover:text-white transition-all shadow-sm"
                                >
                                    <LucideIcon name="file-text" size={16} /> 
                                    原始試卷
                                </a>
                            )}
                            <div className="text-sm font-bold text-blue-600 bg-blue-50 px-4 py-2 rounded-full border border-blue-100">
                                {questions.length} 題
                            </div>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="max-w-3xl mx-auto p-6 md:p-8">
                        {questions.map((q, idx) => (
                            <QuestionItem key={q.id} q={q} />
                        ))}
                        
                        {/* Bottom Action Area */}
                        <div className="mt-16 mb-20 space-y-6">
                            {pdfLink && pdfLink !== '#' && (
                                <div className="p-8 bg-white border border-slate-200 rounded-2xl text-center shadow-lg transform hover:-translate-y-1 transition-all duration-300">
                                    <div className="w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <LucideIcon name="file-question" size={24} />
                                    </div>
                                    <h3 className="font-bold text-slate-800 text-lg mb-2">需要對照原始圖表？</h3>
                                    <p className="text-slate-500 mb-6 max-w-md mx-auto">
                                        部分題目包含複雜圖表或地圖，建議您下載原始試卷 PDF 檔案以獲得最佳閱讀體驗。
                                    </p>
                                    <a 
                                        href={pdfLink} 
                                        target="_blank" 
                                        rel="noopener noreferrer" 
                                        className="inline-flex items-center gap-2 px-8 py-3 bg-slate-900 text-white rounded-xl font-bold hover:bg-blue-600 transition-colors shadow-md"
                                    >
                                        <LucideIcon name="download" size={18} /> 
                                        下載 / 查看原始試卷
                                    </a>
                                </div>
                            )}

                            <div className="text-center">
                                <button 
                                    onClick={() => window.scrollTo({top: 0, behavior: 'smooth'})}
                                    className="text-slate-400 hover:text-slate-600 text-sm font-medium flex items-center justify-center gap-2 mx-auto py-4"
                                >
                                    <LucideIcon name="arrow-up-circle" size={16} />
                                    回到頂部
                                </button>
                                <div className="text-slate-300 text-sm mt-4">
                                    - 試題結束 -
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
